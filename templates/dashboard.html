{% extends 'base.html' %}
{% block title %}Dashboard - FinSecure Bank{% endblock %}
{% block content %}
<h2 class="mb-4">Bienvenido {{ user['full_name'] }}</h2>
{% if error %}
<div class="alert alert-danger">{{ error }}</div>
{% endif %}
{% if msg %}
<div class="alert alert-success">{{ msg }}</div>
{% endif %}
<div class="row mb-4">
  <div class="col-md-6">
    <div class="card text-white bg-success mb-3">
      <div class="card-header">Saldo actual</div>
      <div class="card-body">
        <h3 class="card-title">{{ '%.2f'|format(user['balance']) }} €</h3>
        <p class="card-text">IBAN: {{ user['iban'] }}<br>DNI: {{ user['dni'] }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-6 d-flex align-items-stretch">
    <div class="card w-100">
      <div class="card-header">Acciones</div>
      <div class="card-body">
        <a class="btn btn-outline-primary" href="{{ url_for('verify_external') }}">Verificar URL Externa</a>
        <hr>
        <form method="post" action="{{ url_for('make_transfer') }}">
          <div class="mb-3">
            <label class="form-label">IBAN destino</label>
            <input class="form-control" name="to_iban" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Monto</label>
            <input class="form-control" name="amount" type="number" step="0.01" required>
          </div>
          <button class="btn btn-primary" type="submit">Transferir</button>
        </form>
      </div>
    </div>
  </div>
</div>
<h3>Historial de transferencias</h3>
<table class="table table-striped">
  <thead>
    <tr><th>De</th><th>A</th><th>Monto</th><th>Fecha</th></tr>
  </thead>
  <tbody>
  {% for t in transfers %}
    <tr>
      <td>{{ t['from_iban'] or 'system' }}</td>
      <td>{{ t['to_iban'] }}</td>
      <td>{{ '%.2f'|format(t['amount']) }} €</td>
      <td>{{ t['created'] }}</td>
    </tr>
  {% else %}
    <tr><td colspan="4" class="text-center">Sin transferencias</td></tr>
  {% endfor %}
  </tbody>
</table>
{% endblock %}
